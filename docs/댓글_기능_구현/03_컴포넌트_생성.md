# Phase 3: Giscus ì»´í¬ë„ŒíŠ¸ ìƒì„±

giscus ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•˜ê³  ê´€ë¦¬í•˜ëŠ” Astro ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

## ê¸°ì¡´ íŒ¨í„´ ì°¸ê³ 

í”„ë¡œì íŠ¸ì˜ Disqus ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¸ê³ í•©ë‹ˆë‹¤:

**íŒŒì¼**: [src/components/Disqus.astro](../../src/components/Disqus.astro)

```astro
---
import { disqusConfig } from '@/data/disqus.config'
---

<div class='mx-auto px-6 sm:px-6 max-w-3xl pt-8 md:pt-4 pb-12 md:pb-20'>
  <div id='disqus_thread'></div>
  <script define:vars={{ shortname: disqusConfig.shortname }}>
    var d = document,
      s = d.createElement('script')
    s.src = 'https://' + shortname + '.disqus.com/embed.js'
    s.setAttribute('data-timestamp', String(new Date()))
    s.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light')
    ;(d.head || d.body).appendChild(s)
  </script>
</div>
```

---

## ìƒì„±í•  íŒŒì¼

**íŒŒì¼ ê²½ë¡œ**: `src/components/Giscus.astro`

**ì „ì²´ ì½”ë“œ**:

```astro
---
import { giscusConfig } from '@/data/giscus.config'
---

<div class='mx-auto px-6 sm:px-6 max-w-3xl pt-8 md:pt-4 pb-12 md:pb-20'>
  <div class="giscus"></div>
  <script define:vars={{
    repo: giscusConfig.repo,
    repoId: giscusConfig.repoId,
    category: giscusConfig.category,
    categoryId: giscusConfig.categoryId,
    mapping: giscusConfig.mapping,
    reactionsEnabled: giscusConfig.reactionsEnabled,
    lang: giscusConfig.lang
  }}>
    const script = document.createElement('script')
    script.src = 'https://giscus.app/client.js'
    script.setAttribute('data-repo', repo)
    script.setAttribute('data-repo-id', repoId)
    script.setAttribute('data-category', category)
    script.setAttribute('data-category-id', categoryId)
    script.setAttribute('data-mapping', mapping)
    script.setAttribute('data-strict', '0')
    script.setAttribute('data-reactions-enabled', reactionsEnabled ? '1' : '0')
    script.setAttribute('data-emit-metadata', '0')
    script.setAttribute('data-input-position', 'bottom')
    script.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light')
    script.setAttribute('data-lang', lang)
    script.setAttribute('data-loading', 'lazy')
    script.crossOrigin = 'anonymous'
    script.async = true

    document.querySelector('.giscus').appendChild(script)

    // Listen for theme changes and update giscus
    document.addEventListener('theme-change', (e) => {
      const iframe = document.querySelector('iframe.giscus-frame')
      if (iframe) {
        const theme = localStorage.getItem('theme') ?? 'light'
        iframe.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          'https://giscus.app'
        )
      }
    })
  </script>
</div>
```

---

## ì½”ë“œ ì„¤ëª…

### 1. ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```astro
---
import { giscusConfig } from '@/data/giscus.config'
---
```

- ì•ì„œ ìƒì„±í•œ ì„¤ì • íŒŒì¼ì„ import
- `@/` ë³„ì¹­ì€ `src/` ë””ë ‰í† ë¦¬ë¥¼ ê°€ë¦¬í‚´ (Astro ê¸°ë³¸ ì„¤ì •)

---

### 2. ì»¨í…Œì´ë„ˆ div

```astro
<div class='mx-auto px-6 sm:px-6 max-w-3xl pt-8 md:pt-4 pb-12 md:pb-20'>
  <div class="giscus"></div>
```

- **Tailwind CSS ìŠ¤íƒ€ì¼ë§**: Disqusì™€ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ì‚¬ìš©
  - `mx-auto`: ê°€ìš´ë° ì •ë ¬
  - `max-w-3xl`: ìµœëŒ€ ë„ˆë¹„ ì œí•œ
  - `px-6 sm:px-6`: ì¢Œìš° íŒ¨ë”© (ë°˜ì‘í˜•)
  - `pt-8 md:pt-4`: ìƒë‹¨ íŒ¨ë”© (ë°˜ì‘í˜•)
  - `pb-12 md:pb-20`: í•˜ë‹¨ íŒ¨ë”© (ë°˜ì‘í˜•)
- `.giscus`: giscus ìœ„ì ¯ì´ ë Œë”ë§ë  ìœ„ì¹˜

---

### 3. define:vars (Astro ê¸°ëŠ¥)

```astro
<script define:vars={{
  repo: giscusConfig.repo,
  repoId: giscusConfig.repoId,
  ...
}}>
```

- **Astroì˜ `define:vars` ë””ë ‰í‹°ë¸Œ**
- ì„œë²„ ì¸¡ ë³€ìˆ˜ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì „ë‹¬
- TypeScript ì„¤ì •ê°’ì„ JavaScriptë¡œ ì•ˆì „í•˜ê²Œ ì „í™˜

---

### 4. ë™ì  ìŠ¤í¬ë¦½íŠ¸ ìƒì„±

```javascript
const script = document.createElement('script')
script.src = 'https://giscus.app/client.js'
script.setAttribute('data-repo', repo)
script.setAttribute('data-repo-id', repoId)
...
```

- **ì™œ ë™ì  ìƒì„±?**
  - Astro ë¹Œë“œ ì‹œì ì— ì„¤ì •ê°’ì„ ì£¼ì…í•´ì•¼ í•¨
  - HTMLì— ì§ì ‘ `<script>` íƒœê·¸ë¥¼ ì“°ë©´ ë³€ìˆ˜ ì£¼ì… ë¶ˆê°€
- Disqus ì»´í¬ë„ŒíŠ¸ì™€ ë™ì¼í•œ íŒ¨í„´ (line 8-13)

---

### 5. giscus ì†ì„± ì„¤ì •

```javascript
script.setAttribute('data-mapping', mapping)
script.setAttribute('data-reactions-enabled', reactionsEnabled ? '1' : '0')
script.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light')
```

- **ëª¨ë“  ì„¤ì •ì„ data-* ì†ì„±ìœ¼ë¡œ ì „ë‹¬**
- giscus í´ë¼ì´ì–¸íŠ¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ ì†ì„±ë“¤ì„ ì½ì–´ ìœ„ì ¯ ì´ˆê¸°í™”
- `localStorage.getItem('theme')`: í˜„ì¬ ë‹¤í¬ëª¨ë“œ ìƒíƒœ ì½ê¸° (Disqusì™€ ë™ì¼)

---

### 6. ë‹¤í¬ëª¨ë“œ ë™ê¸°í™”

```javascript
document.addEventListener('theme-change', (e) => {
  const iframe = document.querySelector('iframe.giscus-frame')
  if (iframe) {
    const theme = localStorage.getItem('theme') ?? 'light'
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme } } },
      'https://giscus.app'
    )
  }
})
```

- **ì‚¬ìš©ìê°€ í…Œë§ˆ í† ê¸€ ë²„íŠ¼ì„ í´ë¦­í•  ë•Œ**
- `theme-change` ì´ë²¤íŠ¸ë¥¼ ê°ì§€ (ë¸”ë¡œê·¸ì˜ í…Œë§ˆ í† ê¸€ ì»´í¬ë„ŒíŠ¸ê°€ ë°œìƒ)
- giscus iframeì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ì—¬ í…Œë§ˆ ì‹¤ì‹œê°„ ë³€ê²½
- **postMessage API**: í¬ë¡œìŠ¤ ì˜¤ë¦¬ì§„ iframeê³¼ í†µì‹ í•˜ëŠ” í‘œì¤€ ë°©ì‹

âš ï¸ **ì¤‘ìš”**: ë¸”ë¡œê·¸ì˜ í…Œë§ˆ í† ê¸€ ì»´í¬ë„ŒíŠ¸ê°€ `theme-change` ì´ë²¤íŠ¸ë¥¼ dispatchí•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì´ë²¤íŠ¸ê°€ ì—†ë‹¤ë©´ í…Œë§ˆ ìë™ ë™ê¸°í™”ê°€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

## Disqus vs giscus ì»´í¬ë„ŒíŠ¸ ì°¨ì´ì 

| í•­ëª© | Disqus | giscus |
|------|--------|--------|
| ìŠ¤í¬ë¦½íŠ¸ URL | `https://{shortname}.disqus.com/embed.js` | `https://giscus.app/client.js` |
| ì„¤ì • ë°©ì‹ | URL + timestamp | data-* ì†ì„± |
| í…Œë§ˆ ë™ê¸°í™” | ì£¼ì„ ì²˜ë¦¬ë¨ (ë¯¸êµ¬í˜„) | postMessageë¡œ êµ¬í˜„ë¨ |
| ì»¨í…Œì´ë„ˆ ID | `disqus_thread` | `giscus` (class) |

---

## í…Œë§ˆ ì´ë²¤íŠ¸ í™•ì¸ (ì„ íƒ ì‚¬í•­)

ë¸”ë¡œê·¸ê°€ `theme-change` ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´:

```bash
# í”„ë¡œì íŠ¸ì—ì„œ "theme-change" ê²€ìƒ‰
grep -r "theme-change" src/
```

ë˜ëŠ” ë‹¤ìŒ íŒŒì¼ì„ í™•ì¸:
- `src/components/ThemeToggle.astro` (í…Œë§ˆ í† ê¸€ ë²„íŠ¼)
- `src/layouts/BaseLayout.astro` (í…Œë§ˆ ì œê³µì)

ì´ë²¤íŠ¸ê°€ ì—†ë‹¤ë©´ í…Œë§ˆ í† ê¸€ ì»´í¬ë„ŒíŠ¸ì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€ í•„ìš”:

```javascript
document.dispatchEvent(new CustomEvent('theme-change', { detail: { theme: newTheme } }))
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `src/components/Giscus.astro` íŒŒì¼ ìƒì„±
- [ ] ìœ„ ì „ì²´ ì½”ë“œ ë³µì‚¬/ë¶™ì—¬ë„£ê¸°
- [ ] import ê²½ë¡œ í™•ì¸ (`@/data/giscus.config`)
- [ ] Tailwind í´ë˜ìŠ¤ê°€ Disqusì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

---

## ë‹¤ìŒ ë‹¨ê³„
ğŸ“„ [04_í˜ì´ì§€_í†µí•©.md](./04_í˜ì´ì§€_í†µí•©.md) - ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ í˜ì´ì§€ì— giscus ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
