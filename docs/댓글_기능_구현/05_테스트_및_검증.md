# Phase 5: 테스트 및 검증

구현이 완료되었으면 로컬과 프로덕션에서 테스트합니다.

---

## 1단계: TypeScript 타입 체크

### 실행
```bash
cd c:\Users\seng1\Documents\Projects\sunshower-blog
pnpm run build
```

### 기대 결과
```
✓ Collecting build info...
✓ Completed in XXXms.
✓ Building static entrypoints...
✓ Completed in XXXms.

generating static routes
▶ src/pages/index.astro
  └─ /index.html (+XXms)
...
```

### 오류 발생 시

#### 오류: `Cannot find module '@/data/giscus.config'`
- **원인**: 파일 경로 오류 또는 파일이 생성되지 않음
- **해결**: `src/data/giscus.config.ts` 파일 존재 확인

#### 오류: `Type 'string' is not assignable to type 'never'`
- **원인**: 설정 파일의 타입 정의 오류
- **해결**: `giscus.config.ts`의 interface와 export 구문 확인

#### 오류: `Property 'enabled' does not exist`
- **원인**: import 경로 오류
- **해결**: `import { giscusConfig }` 구문 확인

---

## 2단계: 로컬 개발 서버 실행

### 실행
```bash
pnpm dev
```

### 기대 결과
```
  🚀  astro  v5.16.8 started in XXms

  ┃ Local    http://localhost:4321/
  ┃ Network  use --host to expose

watching for file changes...
```

### 브라우저에서 확인

1. http://localhost:4321/ 접속
2. 아무 블로그 포스트 클릭 (예: `/post/astro`)
3. 페이지 하단까지 스크롤
4. **Related Posts 섹션 아래**에 giscus 위젯 확인

---

## 3단계: giscus 위젯 로드 확인

### 정상 로드 시 화면

페이지 하단에 다음과 같은 요소가 표시되어야 합니다:

```
┌─────────────────────────────────────────┐
│  💬 Comments                            │
│  Powered by giscus                      │
│                                         │
│  [Sign in with GitHub]                  │
│                                         │
│  Comments will load here...             │
└─────────────────────────────────────────┘
```

### 확인 사항

#### ✅ giscus iframe 로드됨
- 개발자 도구 (F12) → Elements 탭
- `<iframe class="giscus-frame">` 존재 확인

#### ✅ 네트워크 요청 성공
- 개발자 도구 (F12) → Network 탭
- `https://giscus.app/client.js` 요청 확인
- Status: 200 OK

#### ✅ Console 오류 없음
- 개발자 도구 (F12) → Console 탭
- giscus 관련 오류 메시지 없는지 확인

---

## 4단계: 설정 오류 디버깅

### 문제: giscus 위젯이 표시되지 않음

#### 원인 1: `enabled: false`
- **확인**: `src/data/giscus.config.ts` 파일 열기
- **해결**: `enabled: true`로 변경

#### 원인 2: 빈 설정값
- **확인**: `repo`, `repoId`, `category`, `categoryId` 값이 빈 문자열 `''`인지 확인
- **해결**: giscus.app에서 받은 값으로 채우기

#### 원인 3: JavaScript 오류
- **확인**: 개발자 도구 Console 탭에서 오류 메시지 확인
- **해결**: 오류 메시지에 따라 수정

---

### 문제: "Error: Discussion category not found"

#### 원인
- GitHub Discussions 카테고리가 존재하지 않음
- 또는 `category` / `categoryId` 값이 잘못됨

#### 해결
1. GitHub 저장소 → Discussions 탭 이동
2. 카테고리 존재 확인 (예: "General", "Comments")
3. giscus.app 재방문하여 올바른 카테고리 ID 다시 복사
4. `giscus.config.ts` 업데이트

---

### 문제: "Error: Repository not found"

#### 원인
- 저장소가 private임 (giscus는 public 저장소만 지원)
- `repo` 값이 잘못됨
- giscus 앱이 설치되지 않음

#### 해결
1. 저장소가 **public**인지 확인
2. `repo` 값 형식 확인: `"username/repo-name"` (따옴표 포함)
3. https://github.com/apps/giscus 에서 앱 설치 확인

---

## 5단계: 다크모드 테마 테스트

### 테스트 방법
1. 블로그 포스트 페이지 열기
2. 테마 토글 버튼 클릭 (상단 헤더의 달/해 아이콘)
3. giscus 위젯의 테마도 함께 변경되는지 확인

### 정상 작동
- **라이트 모드**: giscus 위젯도 밝은 테마
- **다크 모드**: giscus 위젯도 어두운 테마
- 전환이 즉시 반영됨

### 작동하지 않을 때

#### 확인 1: localStorage에 theme 저장되는지 확인
```javascript
// 개발자 도구 Console에서 실행
localStorage.getItem('theme')
// 결과: "light" 또는 "dark"
```

#### 확인 2: theme-change 이벤트 발생 확인
```javascript
// 개발자 도구 Console에서 실행
document.addEventListener('theme-change', () => {
  console.log('Theme changed!')
})
// 테마 토글 버튼 클릭 후 로그 출력되는지 확인
```

#### 해결: 이벤트가 발생하지 않는다면
- 테마 토글 컴포넌트 찾기 (예: `src/components/ThemeToggle.astro`)
- 이벤트 dispatch 코드 추가:
  ```javascript
  document.dispatchEvent(new CustomEvent('theme-change'))
  ```

---

## 6단계: GitHub Discussions 연동 확인

### 테스트 방법
1. 블로그 포스트 하나 열기 (예: `/post/astro`)
2. GitHub 저장소 → **Discussions 탭** 이동
3. 해당 포스트와 매핑된 Discussion이 **자동 생성**되는지 확인

### 기대 결과
- Discussion 제목: 블로그 포스트 경로 또는 제목
- Discussion 카테고리: 설정한 카테고리 (예: "General")
- Discussion 내용: giscus가 자동 생성한 메타데이터

### Discussion이 생성되지 않는다면

#### 원인
- 페이지를 아직 방문하지 않음 (Discussion은 첫 방문 시 생성됨)
- giscus 위젯이 로드되지 않음
- GitHub API 오류

#### 해결
1. 페이지를 새로고침하고 giscus 위젯이 완전히 로드될 때까지 대기
2. 개발자 도구 Network 탭에서 giscus API 요청 확인
3. GitHub Discussions 권한 확인 (giscus 앱이 Discussions 쓰기 권한 있는지)

---

## 7단계: 댓글 작성 테스트

### 테스트 방법
1. giscus 위젯에서 **"Sign in with GitHub"** 클릭
2. GitHub OAuth 인증 진행
3. 댓글 작성 후 **Comment** 버튼 클릭

### 기대 결과
- 댓글이 giscus 위젯에 즉시 표시됨
- GitHub Discussions에도 같은 댓글이 표시됨
- 리액션 버튼(👍❤️) 표시됨

---

## 8단계: 프로덕션 빌드 및 배포

### 빌드
```bash
pnpm run build
```

### 빌드 결과 확인
```
dist/
├── index.html
├── post/
│   ├── astro/
│   │   └── index.html
│   └── ...
└── _astro/
    └── ...
```

### Netlify 배포
```bash
# Netlify CLI 사용 시
netlify deploy --prod

# 또는 Git push로 자동 배포
git add .
git commit -m "feat: Add giscus comments"
git push origin main
```

### 프로덕션 확인
1. https://sunshower-blog.netlify.app/post/astro 접속
2. giscus 위젯 로드 확인
3. 댓글 작성 테스트
4. 다크모드 전환 테스트
5. 모바일 반응형 확인

---

## 9단계: 여러 포스트에서 테스트

### 확인 사항
- 각 포스트마다 **고유한 Discussion**이 생성되는지
- Discussion 제목이 포스트 경로와 매칭되는지
- 포스트 A의 댓글이 포스트 B에 표시되지 않는지

### 테스트 방법
1. 3개 이상의 포스트 방문
2. GitHub Discussions 탭에서 3개의 Discussion 생성 확인
3. 각 Discussion이 올바른 포스트와 연결되어 있는지 확인

---

## 체크리스트 - 전체 검증

### 로컬 테스트
- [ ] `pnpm run build` 성공 (TypeScript 오류 없음)
- [ ] `pnpm dev` 실행 성공
- [ ] 블로그 포스트 하단에 giscus 위젯 표시
- [ ] giscus iframe 로드됨 (개발자 도구 확인)
- [ ] Console에 오류 없음
- [ ] 다크모드 전환 시 giscus 테마도 변경됨

### GitHub 연동
- [ ] GitHub Discussions 탭에 Discussion 자동 생성
- [ ] Discussion 카테고리 올바름
- [ ] 각 포스트마다 고유한 Discussion 생성
- [ ] 댓글 작성 가능 (GitHub 로그인 후)
- [ ] 댓글이 giscus와 GitHub Discussions 양쪽에 표시됨
- [ ] 리액션(👍❤️) 기능 작동

### 프로덕션
- [ ] 프로덕션 빌드 성공
- [ ] Netlify 배포 성공
- [ ] 프로덕션 사이트에서 giscus 작동
- [ ] 모바일에서도 정상 작동
- [ ] 여러 포스트에서 테스트 완료

---

## 문제 해결 참고

### 공통 오류 메시지

| 오류 | 원인 | 해결 |
|------|------|------|
| `Cannot find module` | 파일 경로 오류 | import 경로 및 파일 존재 확인 |
| `Discussion category not found` | 카테고리 불일치 | giscus.app에서 설정 다시 확인 |
| `Repository not found` | private 저장소 또는 앱 미설치 | 저장소 public 설정, giscus 앱 설치 |
| giscus 위젯 안 보임 | `enabled: false` 또는 빈 설정값 | config 파일 확인 |
| 테마 동기화 안 됨 | `theme-change` 이벤트 없음 | 테마 토글 컴포넌트 수정 |

---

## 성공 확인!

모든 체크리스트를 통과했다면 **giscus 댓글 기능이 성공적으로 추가**되었습니다! 🎉

---

## 다음 단계
📄 [06_유지보수_및_팁.md](./06_유지보수_및_팁.md) - 유지보수 가이드 및 추가 설정
